{"version":3,"file":"toc.js","sourceRoot":"","sources":["../src/toc.ts"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;GAcG;;AAEH,OAAO,EAAE,KAAK,EAAE,gBAAgB,EAAE,MAAM,wBAAwB,CAAC;AACjE,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,aAAa,CAAC;AAE7C,OAAO,EAAE,gBAAgB,EAAE,MAAM,SAAS,CAAC;AAE3C;;;;GAIG;AACH,MAAM,OAAO,eAAgB,SAAQ,gBAAgB;IAanD;QACE,KAAK,EAAE,CAAC;QAHV,aAAQ,GAAG,EAAS,CAAC;QAInB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC3C,IAAI,CAAC,cAAc,GAAG,eAAe,CAAC;QACtC,IAAI,CAAC,cAAc,GAAG,eAAe,CAAC;QACtC,IAAI,CAAC,eAAe,GAAG,gBAAgB,CAAC;IAC1C,CAAC;IAED,IAAI;;QACF,MAAA,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,aAAa,CAAC,mCACrC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;IACtC,CAAC;IAED,KAAK;;QACH,MAAA,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,aAAa,CAAC,mCACrC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;IACzC,CAAC;IAED,iBAAiB;QACf,kEAAkE;QAClE,uEAAuE;QACvE,0DAA0D;QAC1D,6BAA6B;QAC7B,IAAI,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,EAAE;YAC/B,IAAI,CAAC,IAAI,EAAE,CAAC;SACb;QAED,KAAK,CAAC,iBAAiB,EAAE,CAAC;QAC1B,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;QAE3C,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE;YACxB,OAAO,CAAC,IAAI,CAAC,8BAA8B,CAAC,CAAC;YAC7C,OAAO;SACR;QAED,IAAI,CAAC,QAAQ,GAAG,gBAAgB,CAC9B,IAAI,CAAC,cAAc,EACnB,wBAAwB,CACzB,CAAC;QAEF,IAAI,CAAC,QAAQ,GAAG,IAAI,oBAAoB,CAAC,IAAI,CAAC,SAAS,EAAE;YACvD,UAAU,EAAE,kBAAkB;SAC/B,CAAC,CAAC;QACH,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,OAA2B,EAAE,EAAE;YACpD,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC;YAC5C,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;QACjC,CAAC,CAAC,CAAC;IACL,CAAC;IACD,SAAS,CAAC,OAA2B;QACnC,OAAO,IAAI,CAAA;sCACuB,OAAO,CAAC,EAAE,KAAK,OAAO,CAAC,SAAS;UAC5D,CAAC;IACT,CAAC;IAED,MAAM;QACJ,OAAO,IAAI,CAAA;;;;;;oBAMK,GAAG,EAAE,CAAC,IAAI,CAAC,KAAK,EAAE;;;;;;;;;;;;;cAaxB,IAAI,CAAC,QAAQ;;;;KAItB,CAAC;IACJ,CAAC;IAED,oBAAoB;QAClB,KAAK,CAAC,oBAAoB,EAAE,CAAC;QAC7B,IAAI,CAAC,KAAK,EAAE,CAAC;QACb,IAAI,CAAC,QAAQ,CAAC,UAAU,EAAE,CAAC;IAC7B,CAAC;IAED,cAAc,CAAC,QAAiB;QAC9B,IAAI,CAAC,MAAM,GAAG,QAAQ,CAAC;IACzB,CAAC;IAED,SAAS,CAAC,QAAqC;;QAC7C,MAAM,KAAK,GAAG,IAAI,GAAG,CACnB,CAAC,GAAG,gBAAgB,CAAC,QAAQ,EAAE,GAAG,EAAE,iBAAiB,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC;YACjE,CAAC,CAAC,YAAY,CAAC,MAAM,CAAC;YACtB,CAAC;SACF,CAAC,CACH,CAAC;QAEF,KAAK,MAAM,OAAO,IAAI,QAAQ,EAAE;YAC9B,MAAM,IAAI,GAAG,IAAI,OAAO,CAAC,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE,CAAC;YACrD,MAAM,IAAI,GAAG,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;YAE7B,IAAI,IAAI,EAAE;gBACR,IAAI,OAAO,CAAC,iBAAiB,GAAG,CAAC,EAAE;oBACjC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;oBACzC,IAAI,CAAC,uBAAuB,GAAG,OAAO,CAAC,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;iBAClE;qBAAM;oBACL,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;iBAC7C;aACF;YAED,MAAM,gBAAgB,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,IAAI,CAAC,eAAe,EAAE,CAAC,CAAC;YAExE,KAAK,CAAC,OAAO,CAAC,CAAC,IAAuB,EAAE,EAAE;;gBACxC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;gBACjE,MAAA,IAAI,CAAC,aAAa,0CAAE,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;YAC5D,CAAC,CAAC,CAAC;YAEH,IAAI,gBAAgB,EAAE;gBACpB,gBAAgB,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;gBACpD,MAAA,gBAAgB,CAAC,aAAa,0CAAE,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;aACpE;YAED,IAAI,CAAC,gBAAgB,IAAI,IAAI,CAAC,uBAAuB,EAAE;gBACrD,MAAM,IAAI,GAAG,KAAK,CAChB,QAAQ,EACR,YAAY,IAAI,CAAC,uBAAuB,IAAI,CAC7C,CAAC;gBACF,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;gBACzC,MAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,aAAa,0CAAE,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;aACzD;SACF;IACH,CAAC;CACF;AA9I6B;IAA3B,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;uDAAqC;AACpB;IAA3C,QAAQ,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;+CAAyB;AA+ItE,cAAc,CAAC,MAAM,CAAC,WAAW,EAAE,eAAe,CAAC,CAAC","sourcesContent":["/*\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     https://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { query, querySelectorAll } from \"@github/query-selector\";\r\nimport { html, property } from \"lit-element\";\r\nimport { ifDefined } from \"lit-html/directives/if-defined\";\r\nimport { BaseStateElement } from \"./state\";\r\n\r\n/**\r\n * Element that renders table of contents.\r\n * @extends {BaseStateElement}\r\n * @final\r\n */\r\nexport class TableOfContents extends BaseStateElement {\r\n  tocActiveClass: string;\r\n  tocBorderClass: string;\r\n  tocVisibleClass: string;\r\n  tocHTML!: any;\r\n  @property({ type: Object }) articleContent!: HTMLElement | null;\r\n  @property({ type: Boolean, reflect: true }) opened!: boolean | true;\r\n\r\n  headings!: HTMLHeadingElement[];\r\n  observer!: IntersectionObserver;\r\n  previouslyActiveHeading: any;\r\n  linkList = [] as any;\r\n\r\n  constructor() {\r\n    super();\r\n    this.scrollSpy = this.scrollSpy.bind(this);\r\n    this.tocActiveClass = \"w-toc__active\";\r\n    this.tocBorderClass = \"w-toc__border\";\r\n    this.tocVisibleClass = \"w-toc__visible\";\r\n  }\r\n\r\n  open() {\r\n    !this.classList.contains(\"w-toc__open\") ??\r\n      this.classList.add(\"w-toc__open\");\r\n  }\r\n\r\n  close() {\r\n    !this.classList.contains(\"w-toc__open\") ??\r\n      this.classList.remove(\"w-toc__open\");\r\n  }\r\n\r\n  connectedCallback() {\r\n    // This sets initial global state before subscribing to the store.\r\n    // If we didn't do this then `this.opened` would always be set to false\r\n    // because onStateChanged runs synchronously after we call\r\n    // super.connectedCallback();\r\n    if (this.hasAttribute(\"opened\")) {\r\n      this.open();\r\n    }\r\n\r\n    super.connectedCallback();\r\n    this.articleContent = this.closest(\"main\");\r\n\r\n    if (!this.articleContent) {\r\n      console.warn(`Article container not found.`);\r\n      return;\r\n    }\r\n\r\n    this.headings = querySelectorAll(\r\n      this.articleContent,\r\n      \"h1[id], h2[id], h3[id]\"\r\n    );\r\n\r\n    this.observer = new IntersectionObserver(this.scrollSpy, {\r\n      rootMargin: \"0px 0px -80% 0px\",\r\n    });\r\n    this.headings.forEach((heading: HTMLHeadingElement) => {\r\n      this.linkList.push(this.makeLinks(heading));\r\n      this.observer.observe(heading);\r\n    });\r\n  }\r\n  makeLinks(heading: HTMLHeadingElement): any {\r\n    return html`<li>\r\n      <a class=\"w-toc__link\" href=\"#${heading.id}\">${heading.innerText}</a>\r\n    </li>`;\r\n  }\r\n\r\n  render() {\r\n    return html`\r\n      <div class=\"w-toc__label\">\r\n        <span>In this article</span>\r\n        <button\r\n          class=\"w-button w-button--secondary w-button--icon\"\r\n          aria-label=\"Close Table of Contents\"\r\n          @click=\"${() => this.close()}\"\r\n        >\r\n          x\r\n        </button>\r\n      </div>\r\n      <div class=\"w-toc__content\">\r\n        <h2 class=\"w-toc__header\">\r\n          <a href=\"#first-input-delay-(fid)\" class=\"w-toc__header--link\"\r\n            >First Input Delay (FID)</a\r\n          >\r\n        </h2>\r\n        <div class=\"w-toc__list\">\r\n          <ul>\r\n            ${this.linkList}\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    super.disconnectedCallback();\r\n    this.close();\r\n    this.observer.disconnect();\r\n  }\r\n\r\n  onStateChanged(isOpened: boolean) {\r\n    this.opened = isOpened;\r\n  }\r\n\r\n  scrollSpy(headings: IntersectionObserverEntry[]) {\r\n    const links = new Map(\r\n      [...querySelectorAll(document, \"a\", HTMLAnchorElement)].map((l) => [\r\n        l.getAttribute(\"href\"),\r\n        l,\r\n      ])\r\n    );\r\n\r\n    for (const heading of headings) {\r\n      const href = `#${heading.target.getAttribute(\"id\")}`;\r\n      const link = links.get(href);\r\n\r\n      if (link) {\r\n        if (heading.intersectionRatio > 0) {\r\n          link.classList.add(this.tocVisibleClass);\r\n          this.previouslyActiveHeading = heading.target.getAttribute(\"id\");\r\n        } else {\r\n          link.classList.remove(this.tocVisibleClass);\r\n        }\r\n      }\r\n\r\n      const firstVisibleLink = this.querySelector(`.${this.tocVisibleClass}`);\r\n\r\n      links.forEach((link: HTMLAnchorElement) => {\r\n        link.classList.remove(this.tocActiveClass, this.tocVisibleClass);\r\n        link.parentElement?.classList.remove(this.tocBorderClass);\r\n      });\r\n\r\n      if (firstVisibleLink) {\r\n        firstVisibleLink.classList.add(this.tocActiveClass);\r\n        firstVisibleLink.parentElement?.classList.add(this.tocBorderClass);\r\n      }\r\n\r\n      if (!firstVisibleLink && this.previouslyActiveHeading) {\r\n        const last = query(\r\n          document,\r\n          `a[href=\"#${this.previouslyActiveHeading}\"]`\r\n        );\r\n        last?.classList.add(this.tocActiveClass);\r\n        last?.parentElement?.classList.add(this.tocBorderClass);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\ncustomElements.define(\"hicks-toc\", TableOfContents);\r\n"]}